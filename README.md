# Tennis Match Winner Predictor AI

## Overview

This project is an AI-based tennis match winner predictor using a **Random Forest** model. According to my testing it currently achieves an average of **93.7% accuracy** (V4 + Threshold) using the following hyperparameters:

- **n_estimators:** 186
- **max_depth:** 18
- **random_state:** None
- **min_samples_split:** 5
- **min_samples_leaf:** 1
- **max_features:** log2
- **class_weight:** balanced

>[!NOTE]
>An average of 93.7% accuracy is only applicable when the threshold is automatically tuned. Without threshold tuning (Threshold = 0.5 as default), the accuracy remains at the average model accuracy of 88.2%, deviations in threshold are commonly minimal, typically ranging at around Â± 0.035 from the default 0.5.

## Details

Currently, there have been 4 versions of the model, only the most recent (V4) of which is accessable

V2: `tennis_model.pkl` with **84.1% Accuracy and 725MB**

V3: `small_tennis_model.pkl` was preferred over V2 since it was only **310MB** with minimal accuracy loss **(-0.4%, 83.7%)**

V4: `final_tennis_model.pkl` is the current model, with **88.2% Accuracy** at approximately **214MB**

However, V4 and Threshold tuning boosts the predictive accuracy up to an average of **93.5%**. 
>[!NOTE]
>Note, that the standalone model still only reaches **88.2%** accuracy, it is just due to the threshold tuning which is made at prediction time that it is able to reach a final accuracy of **93.7%**


## Project Structure 

The project structure is organized in a main folder named  `tennis_prediction`, which contains all scripts and subfolders required for the program to run.

ðŸ“‚ tennis_prediction

 â”œâ”€â”€ ðŸ“‚ analysis

 â”‚   â”œâ”€â”€ decision_tree **(File created by tree.py)**

 â”‚   â”œâ”€â”€ featureImp.py **(Graphing of most deterministic features)**

 â”‚   â”œâ”€â”€ matrix.py **(Creates a confusion matrix to visually show accuracy**)

 â”‚   â”œâ”€â”€ tree.py **(Creates and visualizes all branches and notes of the random forest classifier)**

 â”‚   â”œâ”€â”€ threshold.py **(A second version of the threshold script which also shows statistical analysis as well as a command line confusion matrix)**

 â”œâ”€â”€ ðŸ“‚ data

 â”‚   â”œâ”€â”€ ðŸ“‚ atp

 â”‚   â”‚   â”œâ”€â”€ atp_matches_year.csv **(match data for individual years)**

 â”‚   â”‚   â”œâ”€â”€ ðŸ“‚ group **(contains year range data generated by the model)**

 â”‚   â”œâ”€â”€ ðŸ“‚ preprocessed **(preprocessed datasets)**

 â”‚   â”œâ”€â”€ player_id_mapping.csv **(Player ID to Name mapping)**

 â”œâ”€â”€ ðŸ“‚ results

 â”‚   â”œâ”€â”€ final_tennis_model.pkl **(Final Trained model - *~214MB*)**

 â”œâ”€â”€ main.py **(Main execution script)**

 â”œâ”€â”€ combine.py **(Combines ATP match data into grouped datasets)**

 â”œâ”€â”€ mapping.py **(Creates player ID mapping file - Do not modify)**

 â”œâ”€â”€ model.py **(Defines and trains the AI model, tweaking parameters possible)**

 â”œâ”€â”€ predict.py **(Runs predictions using the trained model - Only callable from main.py)**

 â”œâ”€â”€ matching.py **(Takes player name inputs and finds close matches to mispellings or formats for prediction inputs - Only callable from main.py)**

 â”œâ”€â”€ preprocess.py **(Processes raw data into AI-compatible format)**

 â”œâ”€â”€ threshold.py **(Tunes the threshold for the model to use and dump it alongside the model)**

 â”œâ”€â”€ settings.txt **(Configuration file - Required for all scripts)**

## Installation and Setup
### Perquisites

Ensure that you have **Python 3.x** installed, along with the following dependencies:
`pip install -r requirements.txt`
>[!IMPORTANT]
>This will install pandas, numpy, joblib, scikit-learn, seaborn, matplotlib, graphviz and scikit-optimize, all except for *scikit-optimize* are requirements for the program to run. Seaborn, matplotlib and graphviz are not needed for predictions, but are requirements if you want to run the scripts found in the analysis folder.

### Running the Application

Before running any script, navigate into the main project directory; "tennis_prediction"

`cd tennis_prediction`

Then to run the program:

`python main.py`

## Script details
### `settings.txt`
All of the python scripts rely on the existence of `settings.txt`. If this file is removed, the standalone script will not be able to run. Running `main.py` will regenerate the file with the required data which it needs.

### `main.py`
This script runs the entire tennis match prediction program and requires user input, Upon execution:
1. The user must input a **starting year** and an **ending year**.

    - The dataset contains data from 1985 to 2024.
    - On the very first run of the program, use "all" as it will create the file in which data for all years is stored and used
    - Invalid values outside of this range will not be accepted.
    - Users can enter **"all"** as the starting year **ONLY** to automatically select the full range *(1985-2024)*. In this case, the ending year input is ignored.
2. The user is given the option to **retrain the model** on the chosen dataset.

    - Training takes approximately **2.5 minutes** with default setting, but will take longer if hyperparameters are increased.
>[!WARNING]
>Retraining is only recommended when using the entire dataset. Using smaller datasets may lead to a decreases in accuracy of the model or unrecognized player names.

3. The user is given the option to **calibrate**, **not calibrate** the threshold or **input a custom threshold**. 

    - If calibration is selected, `threshold.py` will run and automatically find the best threshold for predictive accuracy.
    - If no calibration is selected, the model will move on to prediction using the stated threshold in the message.
    - If custom calibration is selected, the user will be prompted with filling in a number for the threshold.

>[!WARNING]
>It is always recommended to calibrate automatically on a random state of None (Which is the model default).

4. The user must enter the names of **two male tennis players** who have participated in ATP Tour before.
    - Names no longer need to be completely precise and accurate as `matching.py` handles improper cases.


5. The program will output a **predicted winner**.
    - When retrained, predictions may vary even for the same matchups due to the AI model not running on a set random state.

### `combine.py`
Responsible for adding ATP tournament game datasets into a collection by year stored in `data/group` as `atp_matches_year_year.csv`. If the two years are the same, this file will not be created.

### `preprocess.py`
Processes raw match data for use by the AI model. It reduces the dataset by keeping only essential columns and merges the original table (split by winners and losers) into a single format, making each one match with their respective data standalone.

### `mapping.py`
Adds every player ID and name into the `player_id_mapping.csv` file, the file currently contains **4178** players.
>[!CAUTION]
>**Do not run or modify this script**, as it may reduce accuracy or result in unrecognized names

### `model.py`
Defines and trains the AI model. Users can tweak hyperparameters for different use cases. The trained model is saved as `small_tennis_model.pkl` and will print an accuracy estimation up to four decimal places upon completion.

>[!INFO]
>It is not recommended to tweak hyperparameters without changing the name of the model as it will overwrite the current version.

### `threshold.py`
Takes the currently saved model and checks for the optimal predictive threshold between 0 and 1 and selects the threshold which maximizes predictive accuracy and resaves the model with the new optimal threshold.

### `matching.py`
Takes the name inputs of the two selected players and runs them through a system which checks whether their names exist in the database, and if not, attempts to find potential matches.

### `predict.py`
Handles match outcome prediction based on preprocessed data. **This script does not run via** `python predict.py` **but is instead called through** `main.py`. It strictly relies on data from `preprocessed/`, any modifications to the `DataFrame` dataset will break the prediction function. The script print the predicted winner for a tennis match between two selected players. 
>[!NOTE]
>**Player names no longer need to be written in full and don't require proper capitalization**

## Data Details
- The `data/atp` folder contains CSV files for each year's ATP matches.
- The **group** subfolder stores aggregated data for year ranges requested by the model.
- The total dataset size is around **25MB**, but may grow are more matched are processed.
- The `player_id_mapping.csv` provides a reference for player names based on their IDs.
- The **data in the `group` and `preprocessed` folders is a modified version of Jeff Sackmann's original ATP tour data**

## Model Details
- The trained **Random Forest model** is stored in the `results/` folder and is approximately ***214MB*** in size.
- The model is trained on historical ATP match data and uses selected hyperparameters to optimize accuracy.

## Credits
This project uses ATP tournament match data provided by **Jeff Sackmann.** You can find the original dataset at [Jeff Sackmann's GitHub Repository](https://github.com/JeffSackmann/tennis_atp). The collections of ATP data in the `group` and `preprocessed` folders are modified versions of Sackmann's original ATP tour data.
The license to the original set of data by Jeff Sackmann is found here at [Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License](https://creativecommons.org/licenses/by-nc-sa/4.0/)

## License  
Tennis Match Winner Predictor AI Â© 2025 by Matteo Walle, Jeff Sackmann is licensed under Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International. To view a copy of this license, visit https://creativecommons.org/licenses/by-nc-sa/4.0/